import { Heading } from "@/components/Heading";

export const metadata = {
  title: "Indexes",
  description:
    "Use indexes to speed up your queries. In this guide, we’ll look at how to create and use indexes in Evolu.",
};

# Indexes

Are your queries taking too long to run? Measure their performance using the `logQueryExecutionTime` option:

```ts
const allTodos = evolu.createQuery(
  (db) => db.selectFrom("todo").orderBy("createdAt").selectAll(),
  {
    logQueryExecutionTime: true,
    // logExplainQueryPlan: false,
  },
);
```

<Note>
  While indexes aren't necessary during development, they’re almost always
  essential in production. Before adding indexes, measure and analyze your
  queries using the `logQueryExecutionTime` and `logExplainQueryPlan` options in
  `createQuery`.
</Note>

If you're new to indexes or want to better understand how to use them effectively, check out this great article: [squeezing-performance-from-sqlite-indexes](https://medium.com/@JasonWyatt/squeezing-performance-from-sqlite-indexes-indexes-c4e175f3c346).

<Heading level={2} id="usage">
  Usage
</Heading>

```ts
const evolu = createEvolu(evoluReactWebDeps)(Schema, {
  // ...
  indexes: (create) => [create("todoCreatedAt").on("todo").column("createdAt")],
});
```

That’s all you need to do. Evolu will automatically create any new indexes you define and drop any that are no longer listed in the indexes array.

<Heading level={2} id="recommendations">
  Recommendations
</Heading>

SQLite offers a powerful [CLI tool](https://sqlite.org/cli.html#index_recommendations_sqlite_expert_) for index recommendations.

To use it:

1. Download the "Precompiled Binaries" [here](https://www.sqlite.org/download.html).
2. Open your database or create a new one.
3. Run `.expert` and paste in the SQL of the query you're analyzing.

You can get the query SQL using the `logQueryExecutionTime` option in `createQuery`, which logs the full SQL statement for easy copy-paste.
